### 文档（核心参考页面）
- https://howarduong.github.io/github.io/doc/documentation_roadmap.html — 项目与文档路线图，指导学习顺序与工具链。  
- https://howarduong.github.io/github.io/content_creation_page.html — 内容创建总览，建模、材质、导出流程要点。  
- https://howarduong.github.io/github.io/doc/html/content_tools_reference_guide/ch12.html — 工具参考（Chapter 12），导出器模式与高级选项（Static/Animated 等）。  
- https://howarduong.github.io/github.io/doc/html/file_grammar_guide/index.html — File Grammar Guide 总入口，文件语法与格式规范（.visual/.model/.primitives/.mfm 等）。  
- https://howarduong.github.io/github.io/doc/html/file_grammar_guide/ch20.html — File Grammar Guide 相关章节（primitives / vertex/index 语法）。  
- https://howarduong.github.io/github.io/doc/html/file_grammar_guide/ch21.html — File Grammar Guide 相关章节（.visual 节与节点格式）。  
- https://howarduong.github.io/github.io/doc/html/file_grammar_guide/ch22.html — File Grammar Guide 相关章节（material / EffectMaterial 语法）。  
- https://howarduong.github.io/github.io/doc/html/file_grammar_guide/ch30.html — File Grammar Guide 相关章节（.model 语法与动作/匹配规则）。  
- https://howarduong.github.io/github.io/doc/html/file_grammar_guide/ch37.html — File Grammar Guide 相关章节（示例与补充语法）。  
- https://howarduong.github.io/github.io/content_creation/02b_create_objects.htm — Content Creation：对象创建细节与规范。  
- https://howarduong.github.io/github.io/content_creation/03_create_model.htm — Content Creation：模型创建流程细则。  
- https://howarduong.github.io/github.io/doc/html/content_tools_reference_guide/ch12.html (子链接集合) — Chapter 12 的子页面（工具选项与导出行为的细化说明）。

### 示例与样板文件（可直接用于格式/字段对齐）
- https://github.com/howarduong/github.io/blob/main/base.model — 官方基础 .model 明文示例（字段、动作与注册样例）。  
- https://github.com/howarduong/github.io/blob/main/base.visual — 官方基础 .visual 明文示例（NodeSection、geometry、material、boundingBox 示例）。  
- https://github.com/howarduong/github.io/blob/main/handrails.mfm — 示例 .mfm / EffectMaterial 文件（材质效果示例）。  
- https://github.com/howarduong/test01/tree/main/avatars — 官方基础模型示例目录（base.visual、base.primitives.backup、贴图等；首要对齐样例）。

### 引擎源码与工具参考
- https://github.com/howarduong/BigWorld-Engine-2.0.1.git — BigWorld 引擎完整源码（tools 子目录包含 3dsMax/Maya 导出器参考实现与格式说明）。  
- https://github.com/howarduong/bigworld_blender_exporter-test.git — 我们正在改进的 Blender 导出器仓库（exporter-test 主项目源码与当前补丁目标）。

### 第三方/对照实现
- https://bitbucket.org/SkepticalFox/bigworld-blender-tools-wot-wowp-wows/src/master/ — SkepticalFox 的 BigWorld Blender 工具集（成熟的静态模型导出实现，可作为功能与写法对照参考）。

### 我们已新增/使用的仓库内文件（开发参考）
- bigworld_blender_exporter/config/exporter.cfg — 导出器默认配置（unitScale 等）。  
- bigworld_blender_exporter/path_utils.py — 路径规范化与 fx 候选查找工具。  
- bigworld_blender_exporter/logger.py — 导出日志工具。  
- bigworld_blender_exporter/config_utils.py — 配置读写辅助。  
- bigworld_blender_exporter/fx_checker.py — fx 弹性解析与候选决策。  
- bigworld_blender_exporter/textures.py — 贴图导出模块（packed 处理、相对路径）。  
- bigworld_blender_exporter/primitives_writer.py — primitives（顶点/索引）写出模块（明文实现）。  
- bigworld_blender_exporter/visual_writer.py — .visual 写入模块（NodeSection/EffectMaterial/geometry）。  
- bigworld_blender_exporter/model_writer.py — .model 最小合规写入模块。  
- bigworld_blender_exporter/exporter_operator.py — 插件导出入口，已注入 Preflight、fx 映射与临时导出流程（整合点）。

---

如果你希望，我可以把这些链接和本地/仓库内样例按“用途”进一步分组并生成一份可下载的参考清单（例如：必须优先阅读的文档、必须对齐的示例文件、对照实现文件路径、开发/测试样例）。你要哪种格式（简洁清单 / 按优先级分组 / 可下载清单）？

### 未完成工作清单（整体视图）

- 实现并集成完整的 primitives_writer（稳定的顶点/索引写出、BNF/二进制兼容）。  
- 实现并集成 textures 导出的完善流程（packed image 处理、格式转换到 DDS 的可选管线、色彩空间处理）。  
- 完善 material → fx 映射与 property 填写逻辑（fx_map.json 驱动、节点解析、属性名对应）。  
- 完整实现 visual_writer 的语法对齐（严格遵循 File Grammar Guide 的 NodeSection、renderSet、primitiveGroup、EffectMaterial 等段落与字段顺序）。  
- 完整实现 model_writer 的语法对齐（nodefullVisual / nodelessVisual、extent/visibilityBox、materialNames、action/animation 占位及必要字段）。  
- 将上述模块在 operator 中串成 ExportJob（临时目录写入 → 自检 → 可选部署），并完善错误回滚与原子部署。  
- 把 primitives 输出从当前明文调试格式升级为项目要求的明文 BNF 或二进制格式（根据 File Grammar Guide 选择），并确保 index_format/vertex_format 精确匹配。  
- 增加严格的大小写敏感存在性检查与修复建议（整个导出链路引用的一致性保证）。  
- 增加导出前 Preflight 的深度检查（UV、法线、切线、packed images、应用变换、材质 slot 与多材质分区），并生成可操作的修复建议。  
- 增加回归测试套件与 sample_blend（Level1–Level4），并实现自动化自检脚本（导出→校验→报告）。  
- 日志与用户反馈完善（导出 manifest、fx_map.json、错误段落复制、导出统计）。  
- 可选：集成外部贴图转换工具（texconv/nvtt）用于 PNG→DDS 转换与 mipmap 生成（需外部依赖管理说明）。

---

### 每项工作的细化任务、位置与预期改动文件

1. primitives 写出（高优先）
   - 文件： bigworld_blender_exporter/primitives_writer.py （扩展/替换现有实现）  
   - 任务：实现严格按 File Grammar Guide 的 vertex_format、index_format、primitive_group 输出；支持 16/32 bit 自动选择；支持切线导出；边界条件（单顶点/超大网格）处理。  
   - 验收：输出 .primitives/.vertices/.indices 文件能通过官方示例比对工具或手动解析脚本验证字段与计数一致。

2. textures 导出与格式处理（高优先）
   - 文件： bigworld_blender_exporter/textures.py（增强）  
   - 任务：处理 packed images、相对路径写出、可选调用 texconv（或提供 hook）；为漫反射/法线分别设置色彩空间导出。  
   - 验收：导出后的贴图能被 ModelEditor 加载并显示正确（法线方向、色彩）。

3. material->fx 映射与 property 填充（高优先）
   - 文件： config/fx_map.json（维护）； bigworld_blender_exporter/fx_checker.py（增强）  
   - 任务：解析 Blender 节点树（Principled/BSDF/Texture）并映射到 fx property 名；若缺失提供候选并记录决定。  
   - 验收：生成 .visual 中 EffectMaterial 的 fx 与 property 与 avatars 示例结构一致；引擎不报找不到 shader。

4. visual_writer 严格化（高优先）
   - 文件： bigworld_blender_exporter/visual_writer.py（完善）  
   - 任务：输出 NodeSection 行格式（4×4 matrix）、renderSet/geometry、primitiveGroup（含 material index/name 映射）、EffectMaterial 正确嵌套、boundingBox 与 materialKind。  
   - 验收：官方 ModelEditor 能解析 .visual 并显示材质槽与包围盒。

5. model_writer 严格化（高优先）
   - 文件： bigworld_blender_exporter/model_writer.py（完善）  
   - 任务：输出 nodefullVisual（或 nodelessVisual）、extent、visibilityBox、materialNames、保留 animation/action 占位并能接受后续填充。  
   - 验收：客户端/工具能加载 .model 并定位到对应 .visual。

6. ExportJob 整合与部署（高优先）
   - 文件： bigworld_blender_exporter/exporter_operator.py（完成整合段）  
   - 任务：实现临时目录原子写入、自检（case-sensitive）、可选部署（复制到 res）与回滚逻辑；记录 export_manifest.json。  
   - 验收：一次导出能在 tmp_export 完整生成所有资源并通过自检；在无错误下能安全部署到目标 res。

7. 自检、回归样例与 CI（中高）
   - 文件： tools/self_check.py、tests/（sample_blend）  
   - 任务：编写自动脚本执行样例导出并比较输出与 avatars 示例；输出 PASS/FAIL 报告。  
   - 验收：所有 sample_blend 在本机环境下通过自检。

8. 日志与 UX（中）
   - 文件： bigworld_blender_exporter/logger.py（增强）与 operator 的 UI 报告  
   - 任务：日志包含 vertex/index counts、fx mapping、导出时长、警告/错误段落。提供可复制的错误段。  
   - 验收：能从日志快速定位缺失文件或字段不一致。

9. 可选：贴图转换集成（低）
   - 文件： bigworld_blender_exporter/textures.py（扩展）、docs/安装说明新增依赖项  
   - 任务：提供 texconv/nvtt 的调用入口与参数说明。  
   - 验收：PNG 导出并自动生成 DDS（mipmap、正确色彩空间）。

---

### 风险项与缓解措施

- 格式细节差异（明文 vs 二进制）可能导致加载失败。  
  - 缓解：先对齐明文 BNF，使用 avatars 示例做比对；在保证行为后再切换为二进制。  
- 贴图色彩空间不当导致渲染偏差。  
  - 缓解：区分漫反射（sRGB）与法线（Linear），并在日志标注。  
- 大小写 / 路径不一致导致加载失败。  
  - 缓解：实现严格的 case-sensitive 检查，并在 preflight 时修正或提示。  
- Blender API/版本差异影响采集。  
  - 缓解：在 preflight 记录 Blender 版本并在 README 列出推荐版本；用 evaluated_depsgraph_get 及 defensively 读取 mesh。  

---

### 验收标准（可测量）

- 最小静态样例：导出结果包含 primitives（vertices/indices）、visual、model、贴图；自检无错误；ModelEditor/客户端能正确加载。  
- 多材质样例：每个 primitive group 对应一个 EffectMaterial，贴图与 fx 载入正常。  
- 日志：每次导出生成 export_manifest.json 和 export_YYYYMMDD_*.log，日志包含顶点/索引计数与 fx mapping。  
- 自动回归：sample_blend Level1–Level3 在本机通过自检脚本。

---

### 预估时间表（按优先级，单人参考）

- 第 1 天：primitives_writer 完整实现 + 单对象测试（高）  
- 第 1 天：textures 导出完善（packed、相对路径）（高）  
- 第 1 天：material->fx 映射增强（fx_map、节点解析初版）（高）  
- 第 1 天：visual_writer/model_writer 严格化并与 primitives 对齐（高）  
- 第 0.5 天：ExportJob 完整整合、自检与部署逻辑（高）  
- 第 0.5–1 天：回归样例与自检脚本（中高）  
- 第 0.5 天：日志/UX 收尾与文档（中）  
- 可选额外：贴图转换集成（1 天）

总计：约 5–7 个工作日，视测试反馈与特殊兼容修复增减。

---

### 我需要你提供的资源与决策（以便我开始逐项实现）

1. 确认目标 res 根在工作树中的相对路径（例如项目根的 res/）。  
2. 提供一到两个你期望作为回归的 .blend（Level1 与 Level3 为优先：单材质与多材质），或允许我用本地创建的样例做初步回归。  
3. 确认自动 FX 处理模式：自动候选→自动使用默认（当前已设自动）还是必须人工确认（交互式）。  
4. 是否允许集成外部贴图转换工具（需要你在运行环境中安装 texconv 或 nvtt）。  

---

如果你确认以上资源与决策，我将按优先级开始逐文件提交补丁：先把 primitives_writer、textures 的最终实现合并并给出测试报告；随后完成 visual/model 写入并完成整合与回归。需要我先从 primitives_writer 开始并提交补丁吗？